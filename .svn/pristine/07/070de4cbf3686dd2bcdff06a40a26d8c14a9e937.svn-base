// # $URL$
// # $Revision$


#define _CRT_SECURE_NO_WARNINGS

#include <stdio.h>
#include <Windows.h>

#include "lex.h"
#include "typectrl.h"
//#include "expr.h"
#include "Gen.h"
#include "main.h"


#define GEN_PREFIX "L"
static WORD GenCount = 0;

LPSTR GenLabel(LPSTR PreFix) {
	LPSTR Label = New(strlen(GEN_PREFIX)+strlen(PreFix)+6+1);
	sprintf(Label, GEN_PREFIX "%s%06ld", PreFix, GenCount++);
	return Label;
 }


static void Pad(FILE *hOut, int n) {
    while (n>0) {
        fprintf(hOut, " ");
        n--;
    }
}


void GenAsmOut(FILE *hOut, LPSTR pszLabel, LPSTR pszOpcode, LPSTR pszOperand, LPSTR pszComment, BOOL fNL) {
    int n;
    if ((pszLabel != NULL) && (*pszLabel != '\0')) { n = fprintf(hOut, "%s:", pszLabel); }
    else { n = 0; }
    Pad(hOut, LABEL_WIDTH - n);

    if ((pszOpcode != NULL) && (*pszOpcode != '\0')) { n = fprintf(hOut, "%s", pszOpcode); }
    else { n = 0; }
    Pad(hOut, OPCODE_WIDTH - n);

    if ((pszOperand != NULL) && (*pszOperand != '\0')) { n = fprintf(hOut, "%s", pszOperand); }
    else { n = 0; }
    Pad(hOut, OPERAND_WIDTH - n);

    if (pszComment != NULL) {
        n = fprintf(hOut, "; %s", pszComment);
        if (fNL) {
            fprintf(hOut, "\n");
        }
    }
    else {
        fprintf(hOut, "\n");
    }

}


BOOL GenIsData(WORD nUse) {
    switch (nUse) {
    case DecSpec:
    case DecPtr:
    case DecArray:  return TRUE;
    case DecId:
    case DecFunc:   return FALSE;
    default:
        Error(FATAL, "GenIsData() unknown use");
    }
    return FALSE;
}


/* eof */
