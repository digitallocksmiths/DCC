/* *************** */
/* Type structures */
/* *************** */

typedef enum {      uConst,  uVar,    uUnary,  uBinary,uTernary,
                    uCast,   uAssign, uInit,   uArrow, uDot,
                    uArray,  uFunc
             } ExprUsage;

typedef enum {      Minus,  Plus,   Neg,    PostInc,PreInc,
                    PostDec,PreDec, SizeOf, Addr,   Ptr,
                    Not
             } TIdExprUnOp;

typedef enum {      Add,    Sub,    Mul,    Div,    Mod,
                    BAnd,   BOr,    BXor,   CEQ,    CNE,
                    CLT,    CLE,    CGT,    CGE,    LAnd,
                    LOr,    BSR,    BSL
             } TIdExprBiOp;

typedef enum {      CondExp
             } TIdExprTriOp;

typedef enum {      AsNop,  AsAdd,  AsSub,  AsMul,  AsDiv,
                    AsMod,  AsBAnd, AsBOr,  AsBXor, AsSR,
                    AsSL
             } TIdExprAssign;

typedef struct TagExprNode TExprNode;
typedef TExprNode  * TPExprNode;
struct TagExprNode {
    ExprUsage       Usage;
    TPDeclSpec      pType;
    TPExprNode      pSibling;
    union {
        struct {
            LONG        lInteger;
        } Const;
        struct {
            LPSTR       pszIdentifier;
        } Var;
        struct {
            WORD        Op;
            TPExprNode  pOperand;
        } Unary;
        struct {
            WORD        Op;
            TPExprNode  pLeft;
            TPExprNode  pRight;
        } Binary;
        struct {
            WORD        Op;
            TPExprNode  First;
            TPExprNode  Second;
            TPExprNode  Third;
        } Ternary;
        struct {
            WORD        Op;
            TPExprNode  pLval;
            TPExprNode  pRval;
        } Assign;
        struct {
            TPExprNode  pTarget;
        } Cast;
        struct {
            TPExprNode  pAssignment;
            //TPExprNode  pSibling;
            TPExprNode  pChildren;
        } Init;
        struct {
            TPExprNode  pRecord;
            LPSTR       pszField;
        } Arrow;
        struct {
            TPExprNode  pRecord;
            LPSTR       pszField;
        } Dot;
        struct {
            TPExprNode  pVector;
            TPExprNode  pIndex;
        } Array;
        struct {
            TPExprNode  pFunc;
            TPExprNode  pParams;
        } pFunc;
    } Use;
 };

TPExprNode  ExprMakeConstC( LONG   Value);
TPExprNode  ExprMakeConstI( LONG   Value);
TPExprNode  ExprMakeConstF( DOUBLE Value);
TPExprNode  ExprMakeConstS( LPSTR  Value);
TPExprNode  ExprMakeVar(    LPSTR  Var);
TPExprNode  ExprMakeUnaryNode(  TIdExprUnOp  Op, TPExprNode Node);
TPExprNode  ExprMakeBinaryNode( TIdExprBiOp  Op, TPExprNode Left,  TPExprNode Right);
TPExprNode  ExprMakeTernaryNode(TIdExprTriOp Op, TPExprNode First, TPExprNode Second, TPExprNode Third);
TPExprNode  ExprMakeArrowNode(  TPExprNode   Left,  LPSTR Field);
TPExprNode  ExprMakeDotNode(    TPExprNode   Left,  LPSTR Field);
TPExprNode  ExprMakeArrayNode(  TPExprNode   Vec,   TPExprNode Ind);
TPExprNode  ExprMakeFuncNode(   TPExprNode   Fn,    TPExprNode Params);
TPExprNode  ExprMakeAssignNode( TIdExprAssign Op, TPExprNode Lval,  TPExprNode Rval);
TPExprNode  ExprMakeCastNode(   TPDeclSpec Type,  TPExprNode Node);

TPExprNode  ExprMakeInitNode(TPExprNode Node);
TPExprNode  ExprMakeInitList(TPExprNode Node);
void        PrintInit(TPExprNode n);

TPExprNode  ExprConcat(TPExprNode pNode, TPExprNode pSibling);


DWORD       ExprConstInt(TPExprNode E);
DOUBLE      ExprConstFloat(TPExprNode E);
LPSTR       ExprConstString(TPExprNode E);

void        ExprCleanUp(TPExprNode n);
#ifdef _DEBUG
void        ExprParse(TPExprNode n,int depth);
#endif // _DEBUG

/* eof */

